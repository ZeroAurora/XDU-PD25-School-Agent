# 批量导入区域重新设计计划

## 问题分析

### 当前布局问题 (第918-992行)

```
┌─────────────────────────────────────────────────────────────┐
│ 批量导入                                                     │
├─────────────────────────────────────────────────────────────┤
│ [Alert: 批量导入说明...]                                     │
│ ┌──────────────────────┐  ┌──────────────────────────────┐ │
│ │                      │  │ ☐ 跳过重复文档               │ │
│ │   [拖拽上传区域]      │  │ [开始导入按钮]               │ │
│ │                      │  │ [进度条]                     │ │
│ └──────────────────────┘  └──────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

| 问题 | 描述 |
|------|------|
| 布局割裂 | 上传区域和操作按钮分离，用户操作流程不连贯 |
| 功能缺失 | 复选框无实际功能，缺少文件验证、预览、模板下载 |
| 反馈不足 | 选中文件后无明确反馈，错误处理不友好 |
| 步骤模糊 | 没有清晰的操作步骤引导 |
| 视觉混乱 | 空间利用率低，各元素间距不一致 |

---

## 重新设计方案

### 设计目标

1. **清晰的步骤流程** - 引导用户按步骤完成导入
2. **更好的视觉层次** - 使用卡片式布局分组相关功能
3. **完整的反馈机制** - 文件验证、预览、进度、结果反馈
4. **可用性提升** - 模板下载、格式说明、错误提示

### 新的布局结构

```
┌───────────────────────────────────────────────────────────────────┐
│ 批量导入                                                           │
├───────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────────┐   │
│ │ 1️⃣ 选择文件                                                   │   │
│ │ ┌─────────────────────────────────────────────────────────┐ │   │
│ │ │  [拖拽区域 - 显示已选文件信息 + 移除按钮]                  │ │   │
│ │ │  + [模板下载链接] + [格式说明]                            │ │   │
│ │ └─────────────────────────────────────────────────────────┘ │   │
│ └─────────────────────────────────────────────────────────────┘   │
│                                                               │
│ ┌─────────────────────────────────────────────────────────────┐   │
│ │ 2️⃣ 导入配置                                                   │   │
│ │ [x] 跳过重复文档    [?] 检测重复策略说明                     │   │
│ │ [x] 验证JSON格式                                            │   │
│ └─────────────────────────────────────────────────────────────┘   │
│                                                               │
│ ┌─────────────────────────────────────────────────────────────┐   │
│ │ 3️⃣ 执行导入                                                   │   │
│ │ [开始导入按钮]                                               │   │
│ │ [进度条 + 状态文字]                                          │   │
│ └─────────────────────────────────────────────────────────────┘   │
│                                                               │
│ ┌─────────────────────────────────────────────────────────────┐   │
│ │ 导入结果                                                     │   │
│ │ ✅ 成功导入 X 篇文档，跳过 Y 篇重复                          │   │
│ │ [查看导入文档]                                               │   │
│ └─────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

---

## 功能规格

### 组件1: 文件选择区域

| 功能 | 描述 |
|------|------|
| 拖拽上传 | 支持 .json 文件，视觉效果反馈 |
| 文件信息显示 | 文件名、大小、行数统计 |
| 移除按钮 | 清除已选文件 |
| 模板下载 | 下载示例 JSON 文件 |
| 格式说明 | 展开/收起 JSON 格式文档 |

### 组件2: 导入配置选项

| 选项 | 默认值 | 说明 |
|------|--------|------|
| skip_duplicates | true | 跳过重复文档 |
| validate_format | true | 验证 JSON 格式 |
| dry_run | false | 试运行模式（预览不实际导入）|

### 组件3: 进度与结果

| 状态 | 展示 |
|------|------|
| 准备中 | 显示配置摘要 |
| 导入中 | 进度条 + 已处理/总数 |
| 完成 | 成功数、跳过数、失败数 |
| 错误 | 错误详情 + 重试按钮 |

---

## 实现步骤

### 阶段1: 基础架构

- [ ] 创建 `BatchImportCard` 独立组件
- [ ] 提取文件状态管理 hook (`useFileUpload`)
- [ ] 提取配置状态管理 hook (`useImportConfig`)
- [ ] 引入 `JSON.parse` 验证和错误处理

### 阶段2: 文件选择 UI

- [ ] 重构 `Upload.Dragger` 组件
- [ ] 添加选中文件信息展示区
- [ ] 添加模板下载按钮和功能
- [ ] 添加格式说明折叠面板
- [ ] 实现文件类型和大小验证

### 阶段3: 配置选项

- [ ] 添加配置选项卡片
- [ ] 实现复选框功能（跳过重复、验证格式）
- [ ] 添加 Tooltip 说明
- [ ] 实现 dry_run 预览功能

### 阶段4: 导入逻辑

- [ ] 重构 `handleBatchImport` 函数
- [ ] 添加分批导入逻辑（避免大文件卡顿）
- [ ] 实现真实进度反馈
- [ ] 添加错误边界和重试机制

### 阶段5: 结果展示

- [ ] 添加结果汇总卡片
- [ ] 实现成功/失败统计
- [ ] 添加"查看导入文档"快捷链接
- [ ] 添加导入日志记录

### 阶段6: 样式优化

- [ ] 优化间距和视觉层次
- [ ] 添加动画效果（进度条、步骤切换）
- [ ] 响应式适配（移动端折叠配置）
- [ ] 无障碍访问优化

---

## 文件结构建议

```
src/
├── components/
│   └── admin/
│       ├── BatchImportCard.tsx    # 主组件
│       ├── FileUploadArea.tsx     # 文件上传区域
│       ├── ImportConfig.tsx       # 配置选项
│       ├── ImportProgress.tsx     # 进度显示
│       └── ImportResult.tsx       # 结果展示
├── hooks/
│   └── useBatchImport.ts          # 批量导入逻辑 hook
└── utils/
    └── jsonValidator.ts           # JSON 验证工具
```

---

## API 扩展建议

### 新增后端端点（可选）

```
GET /api/debug/batch_ingest/preview  # 预览导入结果（不实际写入）
POST /api/debug/batch_ingest/validate  # 验证 JSON 格式
```

---

## 验收标准

1. ✅ 用户能清晰看到三个步骤
2. ✅ 能下载 JSON 模板
3. ✅ 选中文件后显示详细信息
4. ✅ 配置选项功能正常
5. ✅ 导入过程有明确进度反馈
6. ✅ 完成后显示汇总结果
7. ✅ 错误信息友好且可操作
8. ✅ 响应式布局正常

---

## 预计工作量

| 阶段 | 复杂度 | 优先级 |
|------|--------|--------|
| 基础架构 | 中 | P0 |
| 文件选择 UI | 低 | P0 |
| 配置选项 | 低 | P1 |
| 导入逻辑 | 中 | P0 |
| 结果展示 | 低 | P1 |
| 样式优化 | 低 | P2 |
